---
title: "Enhanced Peters-Belson"
author: "Josh Errickson"
date: "`r Sys.Date()`"
output: rmarkdown::pdf_document
vignette: >
  %\VignetteIndexEntry{Matching with Optmatch}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, message=FALSE, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE, prompt = TRUE)
library(epb)
```

# Basic Use

A short example. Lets predict the effect of an afterschool program on an end-of-term exam on the `eottest` (fake) data.

```{r}
data(eottest)
mod1 <- lm(test ~ gpa + male, data = eottest, subset = (afterschool == 0))
mod2 <- pblm(mod1, treatment = eottest$afterschool, data = eottest)
summary(mod2)
confint(mod2)
```

The negative coefficient (-.799) on `pred` shows evidence that students with lower predicted test score in the absence of treatment are showing a larger treatment effect than those with higher predicted test scores.


# Clusters

We implement support for clusters by overloading `meat` (and `sandwich`) from the `sandwich` package and adding a `cluster` argument.

```{r}
data(iris)
mod <- lm(Sepal.Length ~ Petal.Width + Petal.Length, data = iris)
sandwich::meat(mod)
meat(mod)
meat(mod, cluster = iris$Species)
```
